# multi_agent orchestrator config (MVP)
# ä»¥ config.yaml æ‰€åœ¨è³‡æ–™å¤¾ orchestrator/ ç•¶ baseï¼Œ
# ".." æœƒ resolve æˆ repo root/
working_directory: "/workspace"
ingest_url: "http://repo_ingestion_project_2:8000/ingestion/runs"
repo_url: "https://github.com/Careerhack-2026-TSID/fat_free_crm"

llm:
  architect:
    model: "gemini-2.5-pro"
    project: "tsmccareerhack2026-tsid-grp3"
    location: "global"
    temperature: 0
  engineer:
    model: "gemini-2.5-pro"
    project: "tsmccareerhack2026-tsid-grp3"
    location: "global"
    temperature: 0

prompts:
  architect: "prompts/architect.md"
  engineer: "prompts/engineer.md"

# ä¸‹é¢é€™å…©å€‹è·¯å¾‘ï¼Œæ˜¯ã€Œç›¸å°æ–¼ working_directoryï¼ˆrepo rootï¼‰ã€çš„é‚è¼¯è·¯å¾‘
source_dir: "7660381d8c2d45ecba6f0532fba71052"
# repo_dir: "./caa0ea0651474be18c2f4c265c32b9eb"
target_dir: "refactor_repo"


# This template is rendered via Python .format() with:
# {working_directory}, {source_dir}, {target_dir}, {repo_dir}
user_input_template: >
  # Master Protocol: Ruby on Rails to Go/React Refactoring Orchestrator

  **Role**: You are the **Lead Full-Stack Migration Architect**.
  **Mission**: Refactor a legacy **Ruby on Rails (MVC)** application into a modern **Frontend-Backend Separated** architecture.
  **Source Codebase**: `/workspace/init/{source_dir}/snapshot/repo` (Ruby on Rails)
  **Output Destination**: `/workspace/refactor_repo` (Must be structured into `/backend` and `/frontend`)

  ---

  ## ðŸŽ¯ REFACTORING TARGETS (STRICT)

  1.  **Backend** :
      * **Language**: Golang (1.21+)
      * **Framework**: Gin Web Framework
      * **Architecture**: RESTful API (JSON)
      * **Deliverable**: `/workspace/refactor_repo/backend`
      * **Requirement**: Successfully build (`go build`) and pass tests.

  2.  **Frontend** :
      * **Framework**: ReactJS + TypeScript
      * **Styling**: TailwindCSS or CSS Modules (Architect's choice)
      * **Deliverable**: `/workspace/refactor_repo/frontend`
      * **Requirement**: Successfully build and pass UI tests.

  3.  **Infrastructure** :
      * **Docker**: Provide `Dockerfile` and `docker-compose.yml` for both services.

  ---

  ## ðŸ”¹ Phase 1: Deep Analysis & Architectural Mapping

  **Objective**: Deconstruct the Rails monolith into API contracts and UI components.

  **Execution Steps**:

  1.  **Analyze Data Models (The Domain)**:
      * Target: `db/schema.rb` and `app/models/*.rb`.
      * **Action**: Identify all entities and relationships. These will become Go structs in `backend/internal/models`.

  2.  **Analyze Business Logic & Routes**:
      * Target: `config/routes.rb` and `app/controllers/*.rb`.
      * **Action**: Map every Rails route to a Gin API endpoint. Extract logic from Controllers to Go Services.

  3.  **Analyze UI/Views**:
      * Target: `app/views/**/*.erb`.
      * **Action**: Identify the UI components needed for the React frontend. Note the data passed from Controllers to Viewsâ€”this defines your API JSON response structure.

  4.  **Generate Specification (`spec.md`)**:
      * Create the master plan at `/workspace/init/plan/spec.md`.
      * **Crucial Requirement**: You MUST define separate Stages for Backend and Frontend.
      * *Example Staging*:
          * Stage 1: Backend Domain & Database Layer (Go)
          * Stage 2: Backend API Implementation (Gin)
          * Stage 3: Frontend Core & Components (React)
          * Stage 4: Frontend Integration & Pages

  ---

  ## ðŸ”¸ Phase 2: The Refactoring Loop (Iterative Execution)

  **Protocol**: Execute the standard refactoring cycle for **EACH Stage** defined in `spec.md`.

  ### Special Instructions for Split Architecture:

  * **When doing Backend Stages**:
      * Map `app/models/user.rb` -> `backend/internal/models/user.go`.
      * Map `app/controllers/users_controller.rb` -> `backend/internal/handlers/user.go`.
      * Ensure `main.go` sets up the Gin router correctly.

  * **When doing Frontend Stages**:
      * Map `app/views/users/index.html.erb` -> `frontend/src/pages/Users/UserList.tsx`.
      * Ensure the React app calls the API endpoints defined in the Backend stages.

  * **Verification**:
      * For Go: Run `go test ./...`
      * For React: Run `npm test` (or equivalent).
      * **IF FAIL**: Stop, analyze, and fix.

  ---

  ## ðŸ Phase 3: Finalization & Delivery

  **Trigger**: Execute this ONLY after all API and UI stages are complete.

  1.  **Dockerization**:
      * Create `backend/Dockerfile` (Multi-stage build for Go).
      * Create `frontend/Dockerfile` (Node build -> Nginx serve).
      * Create root `docker-compose.yml` to orchestrate DB, Backend, and Frontend.

  2.  **Final Report**:
      * Generate `/workspace/final_report.md` summarizing the transition from Rails MVC to Go+React.

log_filename: "multi_agent.log"
