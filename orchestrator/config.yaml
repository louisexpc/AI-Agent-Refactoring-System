# multi_agent orchestrator config (MVP)
# ‰ª• config.yaml ÊâÄÂú®Ë≥áÊñôÂ§æ orchestrator/ Áï∂ baseÔºå
# ".." ÊúÉ resolve Êàê repo root/
working_directory: "/workspace"
ingest_url: "http://repo_ingestion_project_1:8001/ingestion/runs"
repo_url: "https://github.com/Careerhack-2026-TSID/xml_parser"

llm:
  architect:
    model: "gemini-2.5-pro"
    project: "tsmccareerhack2026-tsid-grp3"
    location: "global"
    temperature: 0
  engineer:
    model: "gemini-2.5-pro"
    project: "tsmccareerhack2026-tsid-grp3"
    location: "global"
    temperature: 0

prompts:
  architect: "prompts/architect.md"
  engineer: "prompts/engineer.md"

# ‰∏ãÈù¢ÈÄôÂÖ©ÂÄãË∑ØÂæëÔºåÊòØ„ÄåÁõ∏Â∞çÊñº working_directoryÔºàrepo rootÔºâ„ÄçÁöÑÈÇèËºØË∑ØÂæë
source_dir: "7660381d8c2d45ecba6f0532fba71052"
# repo_dir: "./caa0ea0651474be18c2f4c265c32b9eb"
target_dir: "refactor_repo"


# This template is rendered via Python .format() with:
# {working_directory}, {source_dir}, {target_dir}, {repo_dir}
user_input_template: >
  # Master Protocol: Python-to-Go Refactoring Orchestrator

  **Role**: You are the **Lead Migration Architect & Orchestrator**.
  **Mission**: Completely refactor a legacy Python codebase into idiomatic Go (Golang), strictly following a multi-stage, test-driven workflow.
  **Target Source**: `/workspace/init/{source_dir}/snapshot/repo`
  **Output Destination**: `/workspace/refactor_repo`

  ---

  ## üõë GLOBAL OPERATIONAL CONSTRAINTS

  1. **Linear Progression**: You must complete Phase 1 before entering Phase 2. You must complete Stage X before starting Stage X+1.
  2. **Immutable Source**: The `/workspace/init` directory is **READ-ONLY**. Never write to it except for the `/workspace/init/plan` folder.
  3. **State Persistence**: All code must be written to disk. Do not rely on context memory for code storage.

  ---

  ## üîπ Phase 1: Deep Analysis & Architectural Specification

  **Objective**: Map the territory and create the battle plan (`spec.md`).

  **Execution Steps**:

  1. **Ingest Dependency Metadata**:
  * Call `read_file` on `/workspace/init/{source_dir}/depgraph/dep_graph_light.json`.
  * Call `read_file` on `/workspace/init/{source_dir}/depgraph/dep_reverse_index_light.json`.


  2. **Source Code Crawl**:
  * Call `list_directory` on `/workspace/init/{source_dir}/snapshot/repo/`.
  * **Filter**: Identify ALL files ending in `.py`.
  * **Ingest**: Call `read_file` on **EVERY** identified `.py` file to load the logic into your reasoning context.


  3. **Generate Specification**:
  * Analyze the functional clusters.
  * Create the master plan file at `/workspace/init/plan/spec.md`.
  * **Requirement**: The `spec.md` must break the migration into specific **Stages** (e.g., Stage 1: Utils, Stage 2: Models, Stage 3: API).

  ---

  ## üî∏ Phase 2: The Refactoring Loop (Iterative Execution)

  **Protocol**: You must execute the following cycle for **EACH Stage** defined in `spec.md`.

  ### The "Stage X" Cycle:

  1. **Context Sync**:
  * Read `spec.md` to identify the current Stage.
  * Read the target Python files for this stage.
  * (If applicable) Read the `test_report.md` from the previous run.


  2. **Planning (Mandatory Pre-computation)**:
  * Create a detailed plan at: `/workspace/stage_<X>/run_<I>/stage_plan/stage_<X>_run_<I>.md`.
  * Create the file mapping JSON at: `/workspace/stage_<X>/run_<I>/stage_plan/mapping_<X>_run_<I>.json`.
  * *Constraint*: Do not write code until these files exist.


  3. **Implementation**:
  * Translate the Python logic to Go.
  * Write the resulting `.go` files to `/workspace/refactor_repo/...`.


  4. **Verification (The Gatekeeper)**:
  * Generate and run a **Unit Test** for the new Go code.
  * **IF PASS**: Mark Stage <X> as COMPLETE. Proceed to Stage <X+1>.
  * **IF FAIL**: Stop. Analyze the error. Increment the Run ID (Run <I+1>) and restart the **Planning** step for this Stage. **DO NOT** proceed to the next stage until tests pass.


  *Repeat this cycle until ALL stages in `spec.md` are marked Complete.*

  ---

  ## üèÅ Phase 3: Finalization & Delivery

  **Trigger**: Execute this ONLY after the final Stage in Phase 2 has passed its unit tests.

  1. **Containerization**:
  * Analyze the full Go codebase in `/workspace/refactor_repo`.
  * Create a production-ready `Dockerfile` in `/workspace/refactor_repo`.
  * Create a `docker-compose.yml` (if database/services are required) in `/workspace/refactor_repo`.


  2. **Project Retrospective**:
  * Generate `/workspace/final_report.md`.
  * Include: Summary of architecture changes, list of resolved dependency challenges, and instructions on how to build/run the Go project.

log_filename: "multi_agent.log"
