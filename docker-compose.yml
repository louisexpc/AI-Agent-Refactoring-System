services:
  repo_ingestion_project_3:
    build:
      context: .
      dockerfile: docker/api/Dockerfile
    image: refactor-repo-ingestion-project-3:latest
    ports:
      - "8003:8000"
    volumes:
      # Share the same named volume across services
      - workspace_project_3:/workspace
    environment:
      PYTHONUNBUFFERED: "1"
    restart: unless-stopped

  orchestrator_project_3:
    build:
      context: .
      dockerfile: docker/agent/Dockerfile
    image: refactor-orchestrator-project-3:latest
    volumes:
      # Allow orchestrator to create sandbox containers (Docker-outside-of-Docker)
      - /var/run/docker.sock:/var/run/docker.sock
      # Share the same named volume across services
      - workspace_project_3:/workspace
    environment:
      PYTHONUNBUFFERED: "1"
    restart: unless-stopped

  sandbox_base:
    build:
      context: .
      dockerfile: docker/sandbox/Dockerfile
    image: refactor-sandbox:latest
    profiles: ["manual"]

volumes:
  workspace_project_3:
    # Lock the actual Docker volume name to exactly "workspace_project_3"
    name: workspace_project_3
